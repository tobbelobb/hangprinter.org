<!DOCTYPE html>

<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#000000">
    <meta name="author" content="Torbjorn Ludvigsen">
    <meta name="keywords" content="Hangprinter, open source, hardware, technology, software, Reprap, development">
    <meta name="description" content="Hangprinter">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Hangprinter">
    <meta property="og:url" content="https://hangprinter.org/doc/v4">
    <meta property="og:description" content="Cable Driven RepRap">
    <meta property="og:image" content="https://hangprinter.org/hangprinter4_small.jpeg">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@tobbelobb">
    <meta name="twitter:creator" content="@tobbelobb">
    <link rel="stylesheet" href="../../style.css?v=0" type="text/css">
    <link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
    <link rel="manifest" href="../../site.webmanifest">
    <link rel="mask-icon" href="../../safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#00aba9">
    <meta name="theme-color" content="#ffffff">
    <title>Hangprinter|HP4 Manual</title>
  </head>
  <body style=width:100%;">
    <div class="masthead">
      <h3 class="masthead-brand">
        <a href="../../" style="text-decoration:none;color:#000;">
          <img src="../../safari-pinned-tab.svg" style="height:50px;width:50px;" />
        </a>
      </h3>
      <nav>
        <ul>
          <li>
            <div class="dropdown">
              <button class="dropbtn"><div class="active">Documentation</a></button>
              <div class="dropdown-content">
                <a href="../../doc/v3">Hangprinter version 3</a>
                <a href="." class="active">Hangprinter version 4</a>
              </div>
            </div>
          </li>
          <li><a href="../../contribute">Contribute</a></li>
          <li><a href="../../about">About</a></li>
          <li><a href="../../FAQ">FAQ</a></li>
          <li><a href="../../resources">Resources</a></li>
          <li><a href="../../newsletter">Newsletter</a></li>
        </ul>
      </nav>
    </div>
    <div id="SiteName" style="text-align:left">
      Hangprinter v4 Manual
    </div>
    <div id="MainContent">
      <a href="https://gitlab.com/tobben/hangprinter-org/edit/master/doc/v4/index.html">üìùEdit on Gitlab</a>
    <h3>Status Of This Document</h3>
      <p>
        This documentation might still have gaping holes here and there.
        If you're building a v4, say hi and connect with other builders in the <a href="https://discord.gg/83G3XnPFXh">discord channel</a>.
      </p>
    <h3>Table of Contents</h3>
      <ul>
        <li><a href="#Sourcing">Sourcing</a></li>
        <li><a href="#Hardware_assembly">Hardware Assembly</a></li>
        <li><a href="#Wiring">Wiring</a></li>
        <li><a href="#Mounting">Mounting</a></li>
        <li><a href="#Calibrating_anchors_and_spool_buildup">Calibrating Anchors and Spool Buildup</a></li>
        <li><a href="#Slicing_and_Usage">Slicing and Usage</a></li>
        <li><a href="#Final_Words">Final Words</a></li>
      </ul>
    <h3 id="Sourcing">Sourcing and Preparing Wiring Loom</h3>
      <figure>
        <a href="https://docs.google.com/spreadsheets/d/1_mMTEF9ZFapn_3FrBvEydh70IPTaQG9gKZ7IVj9G2uM/edit?usp=sharing" target="_blank">
          <img src="./media/check-list.png" alt="" width="500" height="333">
        </a>
        <figcaption>
          Please see the <a href="https://docs.google.com/spreadsheets/d/1_mMTEF9ZFapn_3FrBvEydh70IPTaQG9gKZ7IVj9G2uM/edit?usp=sharing" target="_blank">bill of materials</a> (a Google Docs spreadsheet).
        </figcaption>
      </figure>
      </p>
    <h3 id="Hardware_assembly">Hardware Assembly</h3>
      <p>
        In the <a href="https://gitlab.com/tobben/hangprinter/-/tree/version_4/">repo</a>, there's an Openscad file called <code>layout.scad</code>.
        Open that file with Openscad.
        It shows all the parts, including where and how they're supposed to be mounted.
      </p>
      <figure>
        <a href="./media/layout.png" target="_blank">
          <img src="./media/layout_small.png" alt="" width="500" height="429">
        </a>
        <figcaption>
          This view of the ceiling unit greets you when you open the layout.scad file with Openscad.
          Rotate the view (inside Openscad) by clicking and dragging with your mouse.
          Zoom by scrolling your scroll wheel.
        </figcaption>
      </figure>
      <p>
        To help positioning parts on the ceiling unit,
        2d print out the <a href="https://gitlab.com/tobben/hangprinter/-/raw/version_4/layout_a4.pdf?inline=false">layout_a4.pdf</a>
        and use it as a template.
      </p>
      <p>
        As for the circuit boards and the power supply, place them out in a configuration similar to this:
        <figure>
          <a href="./media/pcb_and_psu_placement.jpeg" target="_blank">
            <img src="./media/pcb_and_psu_placement_small.jpeg" alt="" width="500" height="343">
          </a>
          <figcaption>
            Please click the image to open a larger version.
            Works for all images in this manual.
          </figcaption>
        </figure>
        <figure>
          <a href="./media/believe.jpeg" target="_blank">
            <img src="./media/believe_small.jpeg" alt="" width="500" height="507">
          </a>
          <figcaption>
            Please click the image to open a larger version.
            Works for all images in this manual.
          </figcaption>
        </figure>
      </p>
      <p>
        Hot tips for circuit board placement:
        <ul>
          <li>Use the spacers shipped with the ODrives also for the Duet3.</li>
          <li>The Raspberry Pi uses spacers that are twice as long, which may be 3d printed (see <a href="https://gitlab.com/tobben/hangprinter/-/blob/version_4/stl/pi_mount.stl">pi_mount</a> stl in the repo).</li>
          <li>Make sure that the Duet3's USB port and SD slot are not covered by a 1XD card.</li>
          <li>Make sure the Pi's HDMI1 port is not covered by the Duet3.</li>
        </ul>
      </p>
    <h3 id="Wiring">Wiring</h3>
      <p>
        See
        <ul>
          <li><a href="https://duet3d.dozuki.com/Wiki/Getting_Started_With_Duet_3">Duet 3 docs</a>,</li>
          <li><a href="https://duet3d.dozuki.com/Wiki/Duet_3_Expansion_1XD">1XD expansion board docs</a>,</li>
          <li><a href="https://docs.odriverobotics.com/">ODrive docs</a>.</li>
        </ul>
      </p>
    <h4>The Two CAN Busses</h4>
      <p>
        The Duet3 has two CAN busses coming out of its RJ11 (6P4C) contact.
        These two CAN busses live separately, in two different pairs of wires.
      </p>
      <p>
        The two centermost conductors in the 6P4C contact carry the main CAN bus.
        It transfers step/dir signals from the Duet3 to the 1XDs.
      </p>
      <p>
        <figure>
          <a href="./media/1XD_addresses.jpeg" target="_blank">
            <img src="./media/1XD_addresses_small.jpeg" alt="" width="500" height="281">
          </a>
          <figcaption>
            The main CAN bus goes inside the white wire, from the Duet3 to board 43, to board 42, to board 41, to board 40.
            Board 40 should have termination jumpers on. The other 1XD boards should not.
          </figcaption>
        </figure>
        <figure>
          <a href="./media/easier_to_see2.jpeg" target="_blank">
            <img src="./media/easier_to_see2_small.jpeg" alt="" width="500" height="889">
          </a>
          <figcaption>
            The main CAN bus goes inside the white wire, from the Duet3 to board 43, to board 42, to board 41, to board 40.
            Board 40 should have termination jumpers on. The other 1XD boards should not.
          </figcaption>
        </figure>
      </p>
      <p>
        The rightmost and leftmost pins are not in use in 6P4C contacts.
        So we have two remaining conductors that are not used by the main CAN bus.
        The two remaining conductors carry the ODrives' CAN bus.
      </p>
      <p>
        <figure>
          <a href="./media/signal_wire_guy2.jpeg" target="_blank">
            <img src="./media/signal_wire_guy2_small.jpeg" alt="" width="500" height="281">
          </a>
          <figcaption>
            The jumper wires carry the ODrives' CAN signal from the telephone cable into the ODrive.
          </figcaption>
        </figure>
      </p>
      <p>
        The ODrives' CAN bus also goes inside the white wire, at least on my machine.
        It goes from the Duet3, through board 43, branches off into one ODrive, the other branch continues through board 42, through board 41, and ends in the second ODrive (left one on the image below).
      </p>
      <p>
        With the ODrive CAN bus wired up, make sure you set the termination resistors correctly:
        <figure>
          <a href="./media/term_R_ODrives.jpeg" target="_blank">
            <img src="./media/term_R_ODrives_small.jpeg" alt="" width="500" height="281">
          </a>
          <figcaption>
            There are little switches inside the red circles, that flip CAN termination resistors on and off.
          </figcaption>
        </figure>
      </p>


    <h3 id="Mounting">Mounting</h3>
      <p>
        This part hasn't changed between HP3 and HP4, so I'm linking to old HP3 documentation for now:
      </p>
      <ul>
        <li><a href="https://www.youtube.com/watch?v=iOwjbu2UMlQ&feature=youtu.be&t=3h54m43s">HP3 Build With tobben & Thomas Sanladerer (link directly into mounting)</a></li>
      </ul>
      <p>
        Make sure anchors are rigid. Also, make sure your lines form nice <a href="https://en.wikipedia.org/wiki/Parallelogram">Parallelograms</a> (two pairs of parallel sides).
      </p>
    <h4>Optional Hoisting System</h4>
      <p>
        Screwing the ceiling unit onto the ceiling can be a bit challenging.
        I therefore added a hoisting system to my own HP4.
        See it in <a href="https://twitter.com/tobbelobb/status/1428025129406238723">this tweet</a> and <a href="https://youtu.be/coI8I0QsQFI">this video</a>.
        The little CAD models I used are shared <a href="https://gitlab.com/tobben/hoistit/">here</a>.
      </p>
      <figure>
        <a href="./media/hoistit.png" target="_blank">
          <img src="./media/hoistit_small.png" alt="" width="500" height="343">
        </a>
        <figcaption>
          The optional hoisting system. On my own machine I've routed the line back down
          to the ceiling unit one more time compared to what I had on this image.
        </figcaption>
      </figure>
    <h3>Firmwares and Configuration</h3>
    <p>
      Stock RepRapFirmware will work in the future, but for now, I publish the RepRapFirmware I use here:
      <a href="https://gitlab.com/tobben/hangprinter/-/blob/version_4/firmware/RepRapFirmware/Duet3/Duet3Firmware_MB6HC.bin">link</a>.
      Stock ODrivefirmware works for us out of the box.
    </p>
    <p>
      Please look closely at my config files:
      <ul>
        <li><a href="https://gitlab.com/tobben/hangprinter/-/blob/version_4/firmware/RepRapFirmware/Duet3/config.g">config.g for RepRapFirmware</a></li>
        <li><a href="https://gitlab.com/tobben/hangprinter/-/tree/version_4/firmware/ODrive">configure_odrive.py for ODrivefirmware</a></li>
      </ul>
    </p>

    <h3 id="Calibrating_anchors_and_spool_buildup">Calibrating Anchors and Spool Buildup</h3>
      <p>
        This has changed a lot between HP3 and HP4.
        A computer vision system called hp-mark has been deveoped to assist, and largely automate, the calibration process.
        The system has been built and proved, see <a href="https://www.youtube.com/watch?v=As3Y5J2NTGA">this video</a>.
      </p>
    <h4>Replicating What's Going On In That Video</h4>
      <p>
        Ok, this will be a bit messy.
        hp-mark is still very much in beta, and requires the user to be comfortable doing a few things via the Unix terminal.
        Our main goal is to be able to run the script called <a href="https://gitlab.com/tobben/hp-mark/-/blob/master/use/get_auto_calibration_data_automatically.sh">get_auto_calibration_data_automatically.sh</a>.
      </p>
      <p>
        Build hp-mark (hpm) on your main computer.
        See the <a href="https://gitlab.com/tobben/hp-mark">hp-mark repo</a>,
        and in particular the <code>README.md</code> and the <code>doc</code> directory for some guidance.
      </p>
      <p>
        The get_auto_calibration_data_automatically.sh script expects your camera connected Raspberry to be available
        at the ip called <code>rpi</code> in your <code>/etc/hosts</code> file.
        It's also assuming your Duet3 connected Raspberry to be called <code>duet3</code> in your <code>/etc/hosts</code>.
      </p>
      <p>
        The Raspberry Pi needs the camera to be connected, and it needs ssh to be enabled.
        It also needs a version of raspistill that matches your lens, or else your images' colors won't look pretty.
        To get the one I use (mathing my Arducam lo-distortion 45 deg lens), do
      </p>
      <p>
        <code>
          $ ssh pi@rpi<br />
          $ mkdir repos<br />
          $ cd repos<br />
          $ git clone https://github.com/ArduCAM/NativePiCamera.git<br />
        </code>
      </p>
      <p>
        We also have some LED rings around the lens.
        Since I didn't have the duet3 Rpi yet while developing hp-mark, I used a separate Raspberry.
        To light up the leds, I used GPIO pins o the separate Raspberry that are not available on the duet3 Raspberry.
        So the following method for making the LEDs light up won't work if you plan to use only the duet3 Raspberry.
      </p>
      <p>
        Here's how you get code that lights up the LEDs:
      </p>
      <p>
        <code>
          $ ssh pi@rpi<br />
          $ mkdir repos<br />
          $ cd repos<br />
          $ git clone https://gitlab.com/tobben/rpi_ws281x.git<br />
        </code>
      </p>
      <p>
        The script also assumes the
        <a href="https://gitlab.com/tobben/hangprinter/-/blob/version_4/firmware/RepRapFirmware/Duet3/macros/Torque_mode">Torque_mode macro</a>
        has been installed into your macro folder on the Duet3.
      </p>
      <p>
        With all those things in place, if all the stars align, it should be possible for you to collect the calibration data like this:
      </p>
      <p>
        <code>$ cd path/to/hp-mark/use<br />
          $ ./get_auto_calibration_data_automatically.sh --show result</code>
      </p>
      <p>
        The <code>--show result</code> option will make hpm stop and show you each measurement when it's done, and wait for you to press
        Enter before it continues.
      </p>
      <p>
        After collecting 18 data points (don't worry if a few we unsuccessful or had a warning), it prints out the data it has collected
        in a format that copy/paste friendly for the next script we're going to use: <a href="https://gitlab.com/tobben/auto-calibration-simulation-for-hangprinter/-/blob/hp_mark_adjusted/simulation.py">simulation.py</a>.
      </p>
      <p>
        The output of simulation.py needs to be adjusted by yet another script, called just <a href="https://gitlab.com/tobben/auto-calibration-simulation-for-hangprinter/-/blob/hp_mark_adjusted/harmonize/script.m">script.m</a>.
      </p>
      <p>
        If again, all stars align, you can re-run simulation.py as described inside script.m, and you'll end up with a perfect set of M669 and M666 commands, to copy/paste into your <a href="https://gitlab.com/tobben/hangprinter/-/blob/version_4/firmware/RepRapFirmware/Duet3/config.g">config.g</a>.
      </p>
      <p>
        For anyone who have reached this far: I salute you.
        Reach me via Discord and tell me you need the auto calibration stuff, and I'll up-prioritize automating further and documenting better.
      </p>
    <h3 id="Slicing_and_Usage">Slicing and Usage</h3>
      <p>
        Use any standard slicer you like. Set the correct nozzle size, and configure a circular print bed with the origin in the middle.
        A quite high travel speed, like 600 mm/s or higher, should be possible and beneficial if your effector is fairly light.
        Be aware that max speeds configured in ReprapFirmware and in the ODrives also limit the max speed.
      </p>
      <p>
        Before you start a large print, it's recommended to check if your model fits the print volume or not.
        This is done with <a href="https://gitlab.com/hangprinter/line-collision-detector">line-collision-detector</a>, a tool that is developed specifically for Hangprinter build volume verification.
      </p>
      <p>
        Please note that many slicers will auto center the model before slicing it.
        line-collision-detector will not do that.
        Since you probably want to check if the centered version of your model collides with lines or not, it's recommended to first import your model in the slicer, and then export it from the slicer as an stl, and then run it in the line-collision-detector.
      </p>
      <br /><br /><br />
    <h3 id="Final_Words">Final Words</h3>
      <p>
        Building, mounting, calibrating, and running a HP4 is a big undertaking, and many of the steps are sparsely documented, but you are not alone.
        Be sure to check out the <a href="../../resources">resources</a>, there are some quite good ones.
      </p>
      <p>
        If you spot an error or a missing link in the documentation, then I wholeheartedly recommend that you fix it and contribute the fix back to the repo.
        That is how this project is supposed to work.
        But also, do come by the Discord and say hi, or have a chat via Gitlab merge request or issue.
      </p>
      <p>
        Hangprinter wants to make you feel included and empowered, that's why the project exists.
        If it doesn't, then something in the project is wrong, and we will fix that together.
      </p>
      <p>
        - tobben üë∑
      </p>
        <br /><br /><br /><br /><br /><br /><br />
      </p>
      <p>
        The raw text source of this manual is published under the <a href="https://github.com/tobbelobb/hangprinter/blob/Openscad_version_3/LICENSE" target="_blank">GPL-2.0 license</a>, and is being maintained in the <a href="https://gitlab.com/tobben/hangprinter-org" target="_blank">hangprinter-org repo</a>. All images and videos are also published under the GPL-2.0, except the wiring diagram, which is published under the GPLv3
        license.
      </p>
    </div>
    <script data-goatcounter="https://hangprinter.goatcounter.com/count"
            async src="//gc.zgo.at/count.js"></script>
  </body>
</html>
